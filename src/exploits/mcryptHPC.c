#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <ctype.h>


int main(int argc, char *argv[]){
    
    // check number of arguments
    if(argc != 3){
        printf("Arguments too few or too much\nSpecify execution (0 = print argument, 1 = execute with argument)\nand argument (0 = no ROP, 1 = ROP)\n");
        return -1;
    }
    // first character must be a digit
    if (isdigit(argv[1][0]) == 0 || isdigit(argv[2][0]) == 0){
        printf("At least one argument is not an integer\n");
        return -1;
    }
    // since arguments should be 0 or 1 length of arguments must be checked
    if(strlen(argv[1]) > 1 || strlen(argv[2]) > 1){
        printf("At least one argument is too long\n");
        return -1;
    }
    
    int execution = atoi(argv[1]);
    int input = atoi(argv[2]);
    // arguments must be 0 or 1
    if((execution != 0 && execution != 1) || (input != 0 && input != 1) ){
        printf("argument argument unequal 0 or 1\n");
        return -1;
    }
    
    
    // define program name, path to program, option for ROP execution and argument for normal execution
    char program[] = "mcrypt";
    char option[] = "-d";
    char path[] = "../vulnerable-apps/mcrypt-2.6.8/src/mcrypt";
    //char normal[] = "";
    
    if(execution == 0){
            // print program path and argument with normal.php for normal execution or exploit.php for ROP exploit
            if(input == 0){
                printf("%s %s %s",path, option, "normal.nc");
            } else{
                printf("%s %s %s",path, option, "cyberpunk.nc");
            }
    } else{
            // execute normal.php for normal execution or exploit.php for ROP exploit with argument
            if(input == 0){
                execl(path, program, option, "normal.nc", NULL);
            } else{
                execl(path, program, option, "cyberpunk.nc", NULL);
            }
    }


    return 1;
}
